# Group by a numberical field into a specified number of clusters
index = stream
| kmeans k=5 bytes_in

# Group clusters by cluster number and list features such as network_interface and average of the kmeans field
| stats values(network_interface) AS malware, avg(bytes_in) AS avg_bytes_in by CLUSTERNUM


# Kmeans group by http_referrer and compare the k-clusters 2-7
index=stream app=http 
| stats sum(bytes) AS sum_bytes by http_referrer
| kmeans k=2-7 sum_bytes
- find the knee

sourcetype=access_combined action=purchase 
| stats sum(price) AS order_total by JSESSIONID
| kmeans k=2-7 order_total
- find the knee (k=4) in this example

## Validate Clusters 
index=stream app=http 
| fields bytes http_referrer

sourcetype=access_combined action=purchase product_name=*
| fields price JSESSIONID product_name
| stats list(product_name) AS product_name sum(price) AS spending by JESSIONID
| kmeans k=4 spending
| chart count by product_name CLUSTERNUM

## Kmeans Cluster SSL by bytes_in/bytes_out, Group by CLUSTERNUM & show average
## Bytes In:
index=bro dest_port=443 | kmeans k=5 bytes_in  | stats values(src_ip) AS src_ip, avg(bytes_in) AS avg_bytes_in by CLUSTERNUM

## Bytes Out:
index=bro dest_port=443 | kmeans k=5 bytes_out  | stats values(src_ip) AS src_ip, avg(bytes_out) AS avg_bytes_out by CLUSTERNUM